scale_fill_manual(values= c("#20854e","#bc3c29"))+
stat_pvalue_manual(data = stat.test, label = "p.adj.signif", tip.length = 0.01 ,  hide.ns = TRUE) +
theme_Publication(base_family="serif")+
theme(legend.position = "right", legend.direction = "vertical",
axis.text.x = element_text(size=8, angle=90, hjust=1, vjust=0.5))+
xlab("")+
ylab("Jaccard")
MH_res4 %>%
ggplot(.,  aes(x=group, y=value)) +
geom_boxplot_pattern( aes(fill=group2, pattern=group),
outlier.shape = NA,
linewidth=.3,
color = "black",
alpha=.9,
pattern_fill = "black",
pattern_angle = 45,
pattern_density = 0.1,
pattern_spacing = 0.025,
pattern_key_scale_factor = 0.6) +
scale_pattern_manual(values =  c("none", "stripe", "circle", "crosshatch"))+
geom_jitter(fill="black",shape=21,size=1,width=.2,alpha=.5, color="black")+
facet_grid(chain~cell_subset) +
scale_fill_manual(values= c("#20854e","#bc3c29"))+
stat_pvalue_manual(data = stat.test, label = "p.adj.signif", tip.length = 0.01 ,  hide.ns = TRUE) +
theme_Publication(base_family="arial")+
theme(legend.position = "right", legend.direction = "vertical",
axis.text.x = element_text(size=8, angle=90, hjust=1, vjust=0.5))+
xlab("")+
ylab("Jaccard")
MH_res4 %>%
ggplot(.,  aes(x=group, y=value)) +
geom_boxplot_pattern( aes(fill=group2, pattern=group),
outlier.shape = NA,
linewidth=.3,
color = "black",
alpha=.9,
pattern_fill = "black",
pattern_angle = 45,
pattern_density = 0.1,
pattern_spacing = 0.025,
pattern_key_scale_factor = 0.6) +
scale_pattern_manual(values =  c("none", "stripe", "circle", "crosshatch"))+
geom_jitter(fill="black",shape=21,size=1,width=.2,alpha=.5, color="black")+
facet_grid(chain~cell_subset) +
scale_fill_manual(values= c("#20854e","#bc3c29"))+
stat_pvalue_manual(data = stat.test, label = "p.adj.signif", tip.length = 0.01 ,  hide.ns = TRUE) +
theme_Publication(base_family="mono")+
theme(legend.position = "right", legend.direction = "vertical",
axis.text.x = element_text(size=8, angle=90, hjust=1, vjust=0.5))+
xlab("")+
ylab("Jaccard")
MH_res4 %>%
ggplot(.,  aes(x=group, y=value)) +
geom_boxplot_pattern( aes(fill=group2, pattern=group),
outlier.shape = NA,
linewidth=.3,
color = "black",
alpha=.9,
pattern_fill = "black",
pattern_angle = 45,
pattern_density = 0.1,
pattern_spacing = 0.025,
pattern_key_scale_factor = 0.6) +
scale_pattern_manual(values =  c("none", "stripe", "circle", "crosshatch"))+
geom_jitter(fill="black",shape=21,size=1,width=.2,alpha=.5, color="black")+
facet_grid(chain~cell_subset) +
scale_fill_manual(values= c("#20854e","#bc3c29"))+
stat_pvalue_manual(data = stat.test, label = "p.adj.signif", tip.length = 0.01 ,  hide.ns = TRUE) +
theme_Publication(base_family="sans")+
theme(legend.position = "right", legend.direction = "vertical",
axis.text.x = element_text(size=8, angle=90, hjust=1, vjust=0.5))+
xlab("")+
ylab("Jaccard")
MH_res4 %>%
ggplot(.,  aes(x=group, y=value)) +
geom_boxplot_pattern( aes(fill=group2, pattern=group),
outlier.shape = NA,
linewidth=.3,
color = "black",
alpha=.9,
pattern_fill = "black",
pattern_angle = 45,
pattern_density = 0.1,
pattern_spacing = 0.025,
pattern_key_scale_factor = 0.6) +
scale_pattern_manual(values =  c("none", "stripe", "circle", "crosshatch"))+
geom_jitter(fill="black",shape=21,size=1,width=.2,alpha=.5, color="black")+
facet_grid(chain~cell_subset) +
scale_fill_manual(values= c("#20854e","#bc3c29"))+
stat_pvalue_manual(data = stat.test, label = "p.adj.signif", tip.length = 0.01 ,  hide.ns = TRUE) +
theme_Publication(base_family="TT Times New Roman")+
theme(legend.position = "right", legend.direction = "vertical",
axis.text.x = element_text(size=8, angle=90, hjust=1, vjust=0.5))+
xlab("")+
ylab("Jaccard")
MH_res4 %>%
ggplot(.,  aes(x=group, y=value)) +
geom_boxplot_pattern( aes(fill=group2, pattern=group),
outlier.shape = NA,
linewidth=.3,
color = "black",
alpha=.9,
pattern_fill = "black",
pattern_angle = 45,
pattern_density = 0.1,
pattern_spacing = 0.025,
pattern_key_scale_factor = 0.6) +
scale_pattern_manual(values =  c("none", "stripe", "circle", "crosshatch"))+
geom_jitter(fill="black",shape=21,size=1,width=.2,alpha=.5, color="black")+
facet_grid(chain~cell_subset) +
scale_fill_manual(values= c("#20854e","#bc3c29"))+
stat_pvalue_manual(data = stat.test, label = "p.adj.signif", tip.length = 0.01 ,  hide.ns = TRUE) +
theme_Publication(base_family="courrier")+
theme(legend.position = "right", legend.direction = "vertical",
axis.text.x = element_text(size=8, angle=90, hjust=1, vjust=0.5))+
xlab("")+
ylab("Jaccard")
theme_Publication
theme_Publication<-function(base_size=12) {
(theme_light(base_size=base_size)
+ theme(plot.title = element_text(face = "bold",
size = rel(1.2), hjust = 0.5, margin = margin(0,0,20,0)),
text = element_text(),
panel.background = element_rect(colour = NA),
plot.background = element_rect(colour = NA),
panel.border = element_rect(colour = "black"),
axis.title = element_text(face = "bold",size = rel(1)),
axis.title.y = element_text(angle=90,vjust =2),
axis.title.x = element_text(vjust = -0.2),
axis.text = element_text(),
#axis.line.x = element_line(colour="black"),
#axis.line.y = element_line(colour="black"),
axis.ticks = element_line(),
panel.grid.major = element_line(colour="#f0f0f0"),
panel.grid.minor = element_blank(),
legend.key = element_rect(colour = NA),
legend.position = "bottom",
legend.direction = "horizontal",
legend.box = "vetical",
legend.key.size= unit(0.5, "cm"),
#legend.margin = unit(0, "cm"),
legend.title = element_text(face="italic"),
plot.margin=unit(c(10,5,5,5),"mm"),
strip.background=element_rect(colour="black",fill="#f0f0f0"),
strip.text = element_text(face="bold", colour = "black")
))
}
MH_res4 %>%
ggplot(.,  aes(x=group, y=value)) +
geom_boxplot_pattern( aes(fill=group2, pattern=group),
outlier.shape = NA,
linewidth=.3,
color = "black",
alpha=.9,
pattern_fill = "black",
pattern_angle = 45,
pattern_density = 0.1,
pattern_spacing = 0.025,
pattern_key_scale_factor = 0.6) +
scale_pattern_manual(values =  c("none", "stripe", "circle", "crosshatch"))+
geom_jitter(fill="black",shape=21,size=1,width=.2,alpha=.5, color="black")+
facet_grid(chain~cell_subset) +
scale_fill_manual(values= c("#20854e","#bc3c29"))+
stat_pvalue_manual(data = stat.test, label = "p.adj.signif", tip.length = 0.01 ,  hide.ns = TRUE) +
theme_Publication(base_family="Arial")+
theme(legend.position = "right", legend.direction = "vertical",
axis.text.x = element_text(size=8, angle=90, hjust=1, vjust=0.5))+
xlab("")+
ylab("Jaccard")
MH_res4 %>%
ggplot(.,  aes(x=group, y=value)) +
geom_boxplot_pattern( aes(fill=group2, pattern=group),
outlier.shape = NA,
linewidth=.3,
color = "black",
alpha=.9,
pattern_fill = "black",
pattern_angle = 45,
pattern_density = 0.1,
pattern_spacing = 0.025,
pattern_key_scale_factor = 0.6) +
scale_pattern_manual(values =  c("none", "stripe", "circle", "crosshatch"))+
geom_jitter(fill="black",shape=21,size=1,width=.2,alpha=.5, color="black")+
facet_grid(chain~cell_subset) +
scale_fill_manual(values= c("#20854e","#bc3c29"))+
stat_pvalue_manual(data = stat.test, label = "p.adj.signif", tip.length = 0.01 ,  hide.ns = TRUE) +
theme_Publication()+
theme(legend.position = "right", legend.direction = "vertical",
axis.text.x = element_text(size=8, angle=90, hjust=1, vjust=0.5))+
xlab("")+
ylab("Jaccard")
fout
summary_temp<- summary %>%
filter(!filename %in% fout ) %>%
select(-Mice_ID,-cell_number,-Nbre_seq_per_cell,-Nbre_clo_per_sequences) %>%
reshape2::melt(by=c("filename","chain","cell_subset","Cell_Sample"))
summary_temp$cell_subset = if_else(summary_temp$cell_subset == "CD4+", "Teff", summary_temp$cell_subset)
summary_temp<- summary_temp %>%
mutate(cell_subset=ifelse(filename=="tripod-36-1003_R1.txt","amTreg",
ifelse(filename=="tripod-36-1005_R1.txt","nTreg",cell_subset)))
summary_temp$cell_subset <- factor(summary_temp$cell_subset, levels = c("CD8+", "Teff", "nTreg", "amTreg"))
summary_temp$Cell_Sample <- factor(summary_temp$Cell_Sample, levels = c("indiv", "pool"))
stat.test <- summary_temp %>%
filter(variable == "Nbr_sequences") %>%
group_by(cell_subset, chain) %>%
rstatix::wilcox_test(value ~ Cell_Sample) %>%
rstatix::adjust_pvalue(method = "holm") %>%
rstatix::add_significance("p.adj") %>%
rstatix::add_xy_position()
## Graph
ggpubr::ggboxplot(data = summary_temp %>% filter(variable == "Nbr_sequences"),
x = "Cell_Sample", y = "value", alpha=.5,  fill = "Cell_Sample", color = "Cell_Sample", outlier.shape = NA,
facet.by = c("chain","cell_subset"), scales ="free_y")+
geom_jitter( aes( fill=Cell_Sample),size=1.5,color = "black", shape=21,alpha=.4, position = position_jitterdodge(.2))+
scale_fill_manual(values = nejm_color)+
scale_color_manual(values = nejm_color)+
theme_Publication()+
scale_y_continuous( "Number of sequences", expand = expansion(mult = c(0.1, 0.1))) +
theme(legend.position = "bottom", legend.title = element_blank()) +
ggpubr::stat_pvalue_manual(
stat.test, label = "p.adj.signif", tip.length = 0.01,
hide.ns = FALSE)
dt_filtered=readRDS("/Users/vanessamhanna/Nextcloud/Pool_indiv/dt_filtered.rds")
# Create the summary table
summary <- dt_filtered %>%
dplyr::group_by(filename, Mice_ID, chain, cell_subset, Cell_Sample, cell_number) %>%
dplyr::mutate(Nbr_clonotypes = n_distinct(clonotypes)) %>%
dplyr::mutate(Nbr_sequences = sum(cloneCount)) %>%
dplyr::mutate(Nbre_seq_per_cell = Nbr_sequences/cell_number) %>%
dplyr::mutate(Nbre_clo_per_sequences = Nbr_clonotypes/Nbr_sequences) %>%
dplyr::distinct(filename, cell_subset, chain, Nbr_clonotypes, Nbr_sequences, Nbre_seq_per_cell,Nbre_clo_per_sequences, Cell_Sample, cell_number)
View(summary)
summary_temp<- summary %>%
filter(!filename %in% fout ) %>%
select(-Mice_ID,-cell_number,-Nbre_seq_per_cell,-Nbre_clo_per_sequences) %>%
reshape2::melt(by=c("filename","chain","cell_subset","Cell_Sample"))
summary_temp$cell_subset = if_else(summary_temp$cell_subset == "CD4+", "Teff", summary_temp$cell_subset)
summary_temp$cell_subset <- factor(summary_temp$cell_subset, levels = c("CD8+", "Teff", "nTreg", "amTreg"))
summary_temp$Cell_Sample <- factor(summary_temp$Cell_Sample, levels = c("indiv", "pool"))
stat.test <- summary_temp %>%
filter(variable == "Nbr_sequences") %>%
group_by(cell_subset, chain) %>%
rstatix::wilcox_test(value ~ Cell_Sample) %>%
rstatix::adjust_pvalue(method = "holm") %>%
rstatix::add_significance("p.adj") %>%
rstatix::add_xy_position()
## Graph
ggpubr::ggboxplot(data = summary_temp %>% filter(variable == "Nbr_sequences"),
x = "Cell_Sample", y = "value", alpha=.5,  fill = "Cell_Sample", color = "Cell_Sample", outlier.shape = NA,
facet.by = c("chain","cell_subset"), scales ="free_y")+
geom_jitter( aes( fill=Cell_Sample),size=1.5,color = "black", shape=21,alpha=.4, position = position_jitterdodge(.2))+
scale_fill_manual(values = nejm_color)+
scale_color_manual(values = nejm_color)+
theme_Publication()+
scale_y_continuous( "Number of sequences", expand = expansion(mult = c(0.1, 0.1))) +
theme(legend.position = "bottom", legend.title = element_blank()) +
ggpubr::stat_pvalue_manual(
stat.test, label = "p.adj.signif", tip.length = 0.01,
hide.ns = FALSE)
View(summary)
##b
stat.test <- summary_temp %>%
filter(variable == "Nbr_clonotypes") %>%
group_by(cell_subset, chain) %>%
rstatix::wilcox_test(value ~ Cell_Sample) %>%
rstatix::adjust_pvalue(method = "holm") %>%
rstatix::add_significance("p.adj") %>%
rstatix::add_xy_position()
## Graph
ggpubr::ggboxplot(data = summary_temp %>% filter(variable == "Nbr_clonotypes"),
x = "Cell_Sample", y = "value", alpha=.5,  fill = "Cell_Sample", color = "Cell_Sample", outlier.shape = NA,
facet.by = c("chain","cell_subset"), scales ="free_y")+
geom_jitter( aes( fill=Cell_Sample),size=1.5,color = "black", shape=21,alpha=.4, position = position_jitterdodge(.2))+
scale_fill_manual(values = nejm_color)+
scale_color_manual(values = nejm_color)+
theme_Publication()+
scale_y_continuous( "Number of clonotypes", expand = expansion(mult = c(0.1, 0.1))) +
theme(legend.position = "bottom", legend.title = element_blank()) +
ggpubr::stat_pvalue_manual(
stat.test, label = "p.adj.signif", tip.length = 0.01,
hide.ns = FALSE)
var_chain="TRA"
unique(dt_filtered$filename)
i="tripod-26-681_R1.txt"
newdata <- dt_filtered %>%
filter(filename == i & chain == var_chain) %>%
dplyr::group_by(Mice_ID, cell_subset, Cell_Sample, chain, cdr3aa, filename) %>%
summarise(freq_clo = sum(freq_clo)) %>%
ungroup()
info <- newdata %>% select(Mice_ID, cell_subset, Cell_Sample, chain) %>% distinct()
newdata <- newdata %>%
dplyr::slice_max(n = 1000, order_by = freq_clo, with_ties = F) %>%
dplyr::select(cdr3aa, freq_clo)
#t1 <-Sys.time()
g1s <- find_pairs(newdata$cdr3aa, newdata$cdr3aa)
g1s <- g1s %>%
graph_from_data_frame(directed = F) %>% simplify()
## Create a plot
V(g1s)$degree <- degree(g1s)
cc <- clusters(g1s)
V(g1s)$community <- cc$membership
V(g1s)$freq <-newdata$freq_clo
ggraph(g1s, layout = "graphopt") +
geom_edge_link(alpha = 0.7) +
geom_node_point(aes(fill = degree, size =freq ), alpha = 0.8, shape = 21, show.legend = T, color = "black") +
#scale_color_distiller(guide = F, palette = "Paired") +
scale_fill_gradient(low="blue", high="red", limits=c(0,40))+
scale_size_continuous(limits =c(0, 1))+
ggtitle(paste(info$Mice_ID, info$cell_subset, info$Cell_Sample, info$chain, sep = " "))+
theme_graph()
cc <- clusters(g1s)
cc$csize <- cc$csize[cc$membership]
networks.stats_2b <- data.frame(cdr3aa = names(V(g1s))) %>%
merge(data.frame(cdr3aa = names(cc$membership),
cluster_id = cc$membership,
degree = degree(g1s, mode = "all"),
cluster_size = cc$csize,
Clustering_coef_each = transitivity(g1s, type = "localundirected", isolates = "zero"),
Clustering_coef_full = transitivity(g1s, type = "global", isolates = "zero")))
newdata <- merge(newdata, networks.stats_2b, by = "cdr3aa", all.x = T, all.y = F) %>% distinct(cdr3aa, freq_clo, cluster_id, degree, cluster_size, Clustering_coef_full, Clustering_coef_each)
View(newdata)
file_list <- list.files(path = "./files/", pattern = "_CDR3aa_info_", include.dirs = T)
View(summary)
file_list <- list.files(path = "./files/", pattern = "_CDR3aa_info_", include.dirs = T)
networks_filename = file_list
names(file_list) <- file_list
file_list <- lapply(paste0(path, "Spleen_pool_indiv/networks/", file_list), fread)
file_list <- lapply(paste0("./files/", file_list), fread)
file_list <- mapply(cbind, file_list, "filename" = networks_filename, SIMPLIFY = F)
networks_dt = rbindlist(file_list)
networks_dt = separate(networks_dt, filename, into = c("filename", "chain"), sep = "_CDR3aa_info_")
networks_dt = separate(networks_dt, chain, into = c("chain"), sep = "[.]")
networks_dt = merge(networks_dt, unique(metadata[,-c("chain", "cell_number", "Clin_Group", "sex", "group2")]), by = "filename")
networks_dt2 = melt(networks_dt)
unique(networks_dt2$variable)
networks_dt2$Cell_Sample <- factor(networks_dt2$Cell_Sample, levels = c("indiv", 'pool'))
networks_dt2$cell_subset <- factor(networks_dt2$cell_subset, levels = c("CD8+", 'CD4+', 'nTreg', "amTreg"))
## Graph 1
my_comparisons <- list(c("indiv", "pool"))
ggplot(networks_dt2 %>% filter(!variable %in% c("freq_clo", "cluster_id", "Clustering_coef_full")),
aes(Cell_Sample, value, fill = Cell_Sample))+
geom_jitter(color = "black", shape =20, size = 1.5, width = 0.25, height = 0, alpha = 0.2) +
geom_boxplot(aes(color = Cell_Sample), fill = NA, alpha = 1, outlier.shape = NA) +
facet_grid(variable ~ cell_subset+chain , scales = "free")+
#scale_fill_manual(values = mycolors) +
scale_fill_manual(values = nejm_color)+
scale_color_manual(values = nejm_color)+
ggpubr::stat_compare_means(label= "p.signif", comparisons = my_comparisons, p.adjust.methods = "Holm") +
scale_y_continuous(expand = expansion(mult = c(0, .15))) +
theme_Publication() +
theme(axis.text.x = element_text(angle=90, hjust=1, vjust=0.5))
## Graph 2
cluster_plot <- networks_dt %>%
dplyr::group_by(filename, chain) %>%
arrange(filename, Clustering_coef_each, chain) %>%
mutate(rank = rank(-Clustering_coef_each, ties.method =  "first")) %>%
mutate(AUC = MESS::auc(rank, Clustering_coef_each, type = 'spline')) #%>%
cluster_plot$Cell_Sample <- factor(cluster_plot$Cell_Sample, levels = c("indiv", 'pool'))
cluster_plot$cell_subset <- factor(cluster_plot$cell_subset, levels = c("CD8+", 'CD4+', 'nTreg', "amTreg"))
my_comparisons <- list(c("indiv", "pool"))
cluster_plot %>% select(Cell_Sample, AUC, chain, cell_subset) %>% distinct() %>%
ggplot(aes(Cell_Sample, AUC, fill = Cell_Sample))+
geom_jitter(color = "black", shape =20, size = 3, width = 0.15, height = 0, alpha = 0.5, show.legend = F) +
geom_boxplot(aes(color = Cell_Sample), fill = NA, alpha = 1, outlier.shape = NA) +
facet_grid(chain ~ cell_subset)+
scale_fill_manual(values = nejm_color)+
scale_color_manual(values = nejm_color)+
ylab("Clustering_coef_each (AUC)") +
ggpubr::stat_compare_means(label= "p.signif", comparisons = my_comparisons, p.adjust.methods = "Holm") +
scale_y_continuous(expand = expansion(mult = c(0, .15))) +
theme_Publication() +
theme(axis.text.x = element_text(angle=0, hjust=0.5, vjust=1))
file_list <- list.files(path = "./files/", pattern = "_CDR3aa_info_", include.dirs = T)
networks_filename = file_list
names(file_list) <- file_list
file_list <- lapply(paste0("./files/", file_list), fread)
file_list <- mapply(cbind, file_list, "filename" = networks_filename, SIMPLIFY = F)
networks_dt = rbindlist(file_list)
networks_dt = separate(networks_dt, filename, into = c("filename", "chain"), sep = "_CDR3aa_info_")
networks_dt = separate(networks_dt, chain, into = c("chain"), sep = "[.]")
networks_dt = merge(networks_dt, unique(metadata[,-c("chain", "cell_number", "Clin_Group", "sex", "group2")]), by = "filename")
networks_dt2 = melt(networks_dt)
networks_dt2$Cell_Sample <- factor(networks_dt2$Cell_Sample, levels = c("indiv", 'pool'))
networks_dt2$cell_subset <- factor(networks_dt2$cell_subset, levels = c("CD8+", 'CD4+', 'nTreg', "amTreg"))
## Graph 2
cluster_plot <- networks_dt %>%
dplyr::group_by(filename, chain) %>%
arrange(filename, Clustering_coef_each, chain) %>%
mutate(rank = rank(-Clustering_coef_each, ties.method =  "first")) %>%
mutate(AUC = MESS::auc(rank, Clustering_coef_each, type = 'spline')) #%>%
cluster_plot$Cell_Sample <- factor(cluster_plot$Cell_Sample, levels = c("indiv", 'pool'))
cluster_plot$cell_subset <- factor(cluster_plot$cell_subset, levels = c("CD8+", 'CD4+', 'nTreg', "amTreg"))
my_comparisons <- list(c("indiv", "pool"))
cluster_plot %>% select(Cell_Sample, AUC, chain, cell_subset) %>% distinct() %>%
ggplot(aes(Cell_Sample, AUC, fill = Cell_Sample))+
geom_jitter(color = "black", shape =20, size = 3, width = 0.15, height = 0, alpha = 0.5, show.legend = F) +
geom_boxplot(aes(color = Cell_Sample), fill = NA, alpha = 1, outlier.shape = NA) +
facet_grid(chain ~ cell_subset)+
scale_fill_manual(values = nejm_color)+
scale_color_manual(values = nejm_color)+
ylab("Clustering_coef_each (AUC)") +
ggpubr::stat_compare_means(label= "p.signif", comparisons = my_comparisons, p.adjust.methods = "Holm") +
scale_y_continuous(expand = expansion(mult = c(0, .15))) +
theme_Publication() +
theme(axis.text.x = element_text(angle=0, hjust=0.5, vjust=1))
stat.test <- cluster_plot %>% select(Cell_Sample, AUC, chain, cell_subset) %>% distinct() %>%
group_by(cell_subset, chain) %>%
rstatix::wilcox_test(AUC ~ Cell_Sample) %>%
#ggpubr::compare_means(data = MH_res2, group.by = c("cell_subset1", "chain1"), formula =  value ~ Cell_Sample1, method = "wilcox") %>%
rstatix::adjust_pvalue(method = "holm") %>%
rstatix::add_significance("p.adj") %>% rstatix::add_xy_position()
cluster_plot %>% select(Cell_Sample, AUC, chain, cell_subset) %>% distinct() %>%
ggpubr::ggboxplot(x = "Cell_Sample", y = "AUC", alpha=.5,  fill = "Cell_Sample", color = "Cell_Sample", outlier.shape = NA,
facet.by = c("chain","cell_subset"), scales ="free_y")+
geom_jitter( aes( fill=Cell_Sample),size=1.5,color = "black", shape=21,alpha=.4, position = position_jitterdodge(.2))+
scale_fill_manual(values = nejm_color)+
scale_color_manual(values = nejm_color)+
theme_Publication()+
ylab("Clustering coeffecient (AUC)") +
theme(legend.position = "bottom", legend.title = element_blank()) +
ggpubr::stat_pvalue_manual(
stat.test, label = "p.adj.signif", tip.length = 0.01,
hide.ns = TRUE)
ggplot(cluster_plot, aes(x=rank, y=degree, group=Cell_Sample, color=Cell_Sample, fill=Cell_Sample)) +
geom_line(aes(group = filename), alpha = 0.5) +
#geom_smooth(method = "loess") +
scale_fill_manual(values = nejm_color)+
scale_color_manual(values = nejm_color)+
facet_grid(chain~cell_subset, scales = "free")+
scale_x_log10()+
scale_y_continuous("Clustering coefficient", expand = expansion(mult = c(0, .15))) +
theme_Publication() +
theme(axis.text.x = element_text(angle=90, hjust=1, vjust=0.5))
##c
stat.test <- cluster_plot %>%
group_by(cell_subset, chain, filename, Cell_Sample) %>%
summarise(mean_degree = mean(degree))
stat.test = stat.test %>%
group_by(cell_subset, chain) %>%
rstatix::wilcox_test(mean_degree ~ Cell_Sample) %>%
rstatix::adjust_pvalue(method = "holm") %>%
rstatix::add_significance("p.adj")
my_comparisons <- list(c("indiv", "pool"))
ggplot(cluster_plot, aes(x=Cell_Sample, y=Clustering_coef_full, group=Cell_Sample, color=Cell_Sample, fill=Cell_Sample)) +
geom_point(alpha = 0.3)+
geom_boxplot(aes(color = Cell_Sample), fill = NA, alpha = 1, outlier.shape = NA) +
scale_fill_manual(values = nejm_color)+
scale_color_manual(values = nejm_color)+
facet_grid(chain~cell_subset, scales = "free")+
scale_y_continuous(expand = expansion(mult = c(0, .15))) +
ggpubr::stat_compare_means(label= "p.signif", comparisons = my_comparisons, p.adjust.methods = "Holm") +
theme_Publication() +
theme(axis.text.x = element_text(angle=90, hjust=1, vjust=0.5))
networks_dt3 <- networks_dt %>% dplyr::group_by(chain, cell_subset, Cell_Sample) %>%
dplyr::mutate(total_mice = n_distinct(Mice_ID)) %>%
dplyr::group_by(cdr3aa, chain, cell_subset, Cell_Sample) %>%
dplyr::mutate(sharing = n_distinct(Mice_ID)) %>%
dplyr::mutate(cdr3aa_category = if_else(sharing == 1 , "private", "public")) %>%
dplyr::group_by(chain, cell_subset, Cell_Sample, cdr3aa_category, Mice_ID) %>%
dplyr::summarise(mean_Clustering_coef_each = mean(Clustering_coef_each))
## Recodage de networks_dt3$Cell_Sample
networks_dt3$Cell_Sample[networks_dt3$Cell_Sample == "indiv"] <- "Mouse"
networks_dt3$Cell_Sample[networks_dt3$Cell_Sample == "pool"] <- "Metamouse"
## Réordonnancement de networks_dt3$cell_subset
networks_dt3$cell_subset <- factor(networks_dt3$cell_subset,
levels = c("CD8+", "CD4+", "nTreg", "amTreg")
)
## Réordonnancement de networks_dt3$cell_subset
networks_dt3$Cell_Sample <- factor(networks_dt3$Cell_Sample,
levels = c("Mouse", "Metamouse")
)
networks_dt3 %>% #filter(sharing == 1) %>%
ggplot(aes(x = Cell_Sample, y = mean_Clustering_coef_each, color=Cell_Sample, fill=Cell_Sample)) +
#geom_smooth(method = "lm", se = TRUE, alpha = 0.3) +
geom_point(alpha = 0.8)+
geom_boxplot(aes(color = Cell_Sample), fill = NA, alpha = 1, outlier.shape = NA) +
scale_fill_manual(values = nejm_color)+
scale_color_manual(values = nejm_color)+
facet_grid(cdr3aa_category+chain~cell_subset, scales = "free")+
scale_y_continuous(expand = expansion(mult = c(0, .15))) +
ggpubr::stat_compare_means(label= "p.signif", comparisons = my_comparisons, p.adjust.methods = "Holm") +
theme_Publication() +
theme(axis.text.x = element_text(angle=0, hjust=0.5, vjust=1))
stat.test <- networks_dt3 %>%
group_by(cell_subset, chain, cdr3aa_category) %>%
rstatix::wilcox_test(mean_Clustering_coef_each ~ Cell_Sample) %>%
#ggpubr::compare_means(data = MH_res2, group.by = c("cell_subset1", "chain1"), formula =  value ~ Cell_Sample1, method = "wilcox") %>%
rstatix::adjust_pvalue(method = "holm") %>%
rstatix::add_significance("p.adj") %>% rstatix::add_xy_position(x = "cdr3aa_category", dodge = 0.8)
networks_dt3 %>%
ggpubr::ggboxplot(x = "cdr3aa_category", y = "mean_Clustering_coef_each", alpha=.5,  fill = "Cell_Sample", color = "Cell_Sample", outlier.shape = NA,
facet.by = c("chain","cell_subset"), scales ="free_y")+
geom_jitter(aes(fill=Cell_Sample),size=1.5,color = "black", shape=21,alpha=.4, position = position_jitterdodge(.1))+
scale_fill_manual(values = nejm_color)+
scale_color_manual(values = nejm_color)+
theme_Publication()+
ylab("Mean clustering coefficient") +
facet_grid(chain~cell_subset, scales = "free")+
theme(legend.position = "bottom", legend.title = element_blank()) +
ggpubr::stat_pvalue_manual(
stat.test, label = "p.adj.signif", tip.length = 0.01)
24+27
dt_all<- readRDS("./files/dt_all.rds")
dt_all<- readRDS("/Users/vanessamhanna/Nextcloud/Pool_indiv/metaTCR_vs_MetaMouse/data/dt_all.rds")
View(dt_all)
dt_all<- dt_all %>% select(filename, chain, cell_subset, cell_Sample, cell_number) %>% distinct()
dt_all<- dt_all %>% select(filename, chain, cell_subset, Cell_Sample, cell_number) %>% distinct()
dt_all<- readRDS("/Users/vanessamhanna/Nextcloud/Pool_indiv/metaTCR_vs_MetaMouse/data/dt_all.rds")
dt_all<- dt_all %>% select(filename, chain, cell_subset, Mice_ID, cell_number) %>% distinct()
dt_all<- readRDS("/Users/vanessamhanna/Nextcloud/Pool_indiv/metaTCR_vs_MetaMouse/data/dt_all.rds")
test<- dt_all %>% select(filename, chain, cell_subset, Mice_ID,nb_clonotypes,nb_sequences, cell_number) %>% distinct()
View(test)
